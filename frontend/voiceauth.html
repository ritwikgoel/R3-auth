<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2FA</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://requirejs.org/docs/release/2.3.5/minified/require.js"></script>
    <script src="/voiceauth.js"></script>
    
</head>
<style>
    .btnStart{
        background: linear-gradient(to right, #99004d 0%, #ff0080 100%);
  font-size: 17px;
  color: #fff;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.3s ease;
  padding: 10px 24px;
}
.btnStop{
        background: linear-gradient(to right, #99004d 0%, #ff0080 100%);
  font-size: 17px;
  color: #fff;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.3s ease;
  padding: 10px 24px;
}
</style>
<script>
       
    let audioIN = { audio: true };
    navigator.mediaDevices.getUserMedia(audioIN).then(function (mediaStreamObj) {
        let audio = document.querySelector('audio');
        if ("srcObject" in audio) {
          audio.srcObject = mediaStreamObj;
        }
        else {  
          audio.src = window.URL.createObjectURL(mediaStreamObj);
        }
        audio.onloadedmetadata = function (ev) {
          audio.play();
        };
        let start = document.getElementById('btnStart');
        let stop = document.getElementById('btnStop');  
        let playAudio = document.getElementById('adioPlay');
        let mediaRecorder = new MediaRecorder(mediaStreamObj);
        start.addEventListener('click', function (ev) {
          mediaRecorder.start();
        })
          stop.addEventListener('click', function (ev) {
          mediaRecorder.stop();
        });
        mediaRecorder.ondataavailable = function (ev) {
          dataArray.push(ev.data);
        }
        let dataArray = [];
        mediaRecorder.onstop = function (ev) {
  
          let audioData = new Blob(dataArray, 
                    { 'type': 'audio/mp3;' });
            
          dataArray = [];
          let audioSrc = window.URL
              .createObjectURL(audioData);
            playAudio.src = audioSrc;
            //alert(audioSrc);
            
            var myReader = new FileReader();
            myReader.addEventListener("loadend", function(e){
            console.log(e.srcElement.result); //prints the weird string 
});
           //alert(URL.createObjectURL(audioData));
            console.log( myReader.readAsText(audioData))


            
        }
      })
        .catch(function (err) {
        console.log(err.name, err.message);
      });
    

</script>
<body>
    <div class="container">
        <form name="voiceauth" action="#">
            <div class="title">Voice Authentication</div>
            <div class="">Say "Banana is a berry"</div> 
            <button class="btnStart" id="btnStart">START</button>
            <button class="btnStop" id="btnStop">STOP</button>
            <audio controls></audio>
  <audio id="adioPlay" controls></audio> 
        </form>
    </div>
</body>
</html>